name: "Fetch GitHub Stats"

on:
  schedule:
    # hourly at minute 0
    - cron: "0 * * * *"
  workflow_dispatch: {}

jobs:
  fetch:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Fetch stats and languages SVG
        run: |
          set -e
          mkdir -p public
          # Try your self-hosted service first, then official public service, finally fallback local SVGs
          if curl -fsSL "https://github-readme-stats-theadityanvs-projects.vercel.app/api?username=theAdityaNVS&theme=default&show_icons=true&hide_border=true&count_private=true" -o public/github-stats.svg; then
            echo "fetched github-stats.svg from self-hosted"
          elif curl -fsSL "https://github-readme-stats.vercel.app/api?username=theAdityaNVS&theme=default&show_icons=true&hide_border=true&count_private=true" -o public/github-stats.svg; then
            echo "fetched github-stats.svg from public service"
          else
            echo "both fetches failed — using fallback for github-stats.svg"
            cp public/github-stats-fallback.svg public/github-stats.svg || true
          fi

          if curl -fsSL "https://github-readme-stats-theadityanvs-projects.vercel.app/api/top-langs/?username=theAdityaNVS&theme=default&show_icons=true&hide_border=true&layout=compact" -o public/github-langs.svg; then
            echo "fetched github-langs.svg from self-hosted"
          elif curl -fsSL "https://github-readme-stats.vercel.app/api/top-langs/?username=theAdityaNVS&theme=default&layout=compact&hide_border=true" -o public/github-langs.svg; then
            echo "fetched github-langs.svg from public service"
          else
            echo "both fetches failed — using fallback for github-langs.svg"
            cp public/github-langs-fallback.svg public/github-langs.svg || true
          fi

      - name: Commit updated SVGs
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git add public/github-stats.svg public/github-langs.svg || true
          git commit -m "chore: update github stats (automated)" || echo "no changes to commit"
          git push || echo "push failed"

# Contact Form Debug Checklist

## Issue: Form not submitting on Vercel deployment

### 1. Check Environment Variables in Vercel
- [ ] Go to Vercel Dashboard → Your Project → Settings → Environment Variables
- [ ] Verify that Supabase Integration added these two variables:
  - `NEXT_PUBLIC_SUPABASE_URL`
  - `NEXT_PUBLIC_SUPABASE_ANON_KEY`
- [ ] OR manually add these:
  - `VITE_SUPABASE_URL`
  - `VITE_SUPABASE_ANON_KEY`
- [ ] After adding/verifying, **Redeploy** the project

### 2. Check Browser Console on Deployed Site
1. Open https://adityanvs.in
2. Press F12 to open Developer Tools
3. Go to the **Console** tab
4. Scroll to the Contact section
5. Fill out the form and click "Send Message"
6. **Check for errors**:
   - `Supabase client not initialized` → Environment variables missing
   - `permission denied` → RLS policies not set up
   - `relation "public.messages" does not exist` → Table not created
   - CORS error → Supabase URL misconfigured

### 3. Verify Supabase Table Setup
1. Go to [Supabase Dashboard](https://supabase.com/dashboard)
2. Navigate to **Table Editor** → Check if `messages` table exists
3. If not, go to **SQL Editor** and run:
   ```sql
   -- Create the messages table
   create table if not exists public.messages (
     id bigint generated by default as identity primary key,
     created_at timestamp with time zone default timezone('utc'::text, now()) not null,
     name text not null,
     email text not null,
     message text not null
   );

   -- Enable Row Level Security (RLS)
   alter table public.messages enable row level security;

   -- Policy 1: Allow anyone (anon) to insert messages
   create policy "Enable insert for everyone" 
   on public.messages 
   for insert 
   with check (true);

   -- Policy 2: Allow only authenticated users to view messages
   create policy "Enable read access for authenticated users only" 
   on public.messages 
   for select 
   using (auth.role() = 'authenticated');
   ```

### 4. Check RLS Policies
1. In Supabase Dashboard → **Authentication** → **Policies**
2. Find the `messages` table
3. Verify these policies exist:
   - ✅ **INSERT**: "Enable insert for everyone" (applies to `anon` role)
   - ✅ **SELECT**: "Enable read access for authenticated users only"

### 5. Test Supabase Connection Directly
Run this in your browser console on the deployed site:
```javascript
// Check if Supabase is initialized
console.log('Supabase client:', window.supabase);

// Try manual insert (paste your actual URL and key)
const { createClient } = window.supabase;
const testClient = createClient(
  'YOUR_SUPABASE_URL',
  'YOUR_ANON_KEY'
);

const { data, error } = await testClient
  .from('messages')
  .insert([
    { name: 'Test', email: 'test@example.com', message: 'Debug test' }
  ]);

console.log('Insert result:', { data, error });
```

### 6. Common Issues and Solutions

| Error | Solution |
|-------|----------|
| "Supabase client not initialized" | Add environment variables in Vercel and redeploy |
| "permission denied for table messages" | Run RLS policies SQL (step 3) |
| "relation does not exist" | Create the `messages` table (step 3) |
| Form submits but no success message | Check if `created_at` field is auto-generated (should be) |
| "Failed to send message" | Check browser console for specific error |

### 7. Quick Fix: Re-add Environment Variables
If nothing works, try this:
1. Go to Vercel → Settings → Environment Variables
2. **Delete** all Supabase-related variables
3. **Re-add** them manually:
   ```
   VITE_SUPABASE_URL = https://your-project.supabase.co
   VITE_SUPABASE_ANON_KEY = your-anon-key
   ```
4. Go to **Deployments** → Click on the latest deployment → **Redeploy**
5. Wait for redeployment to finish
6. Test the form again

### 8. Last Resort: Check Network Tab
1. Open Developer Tools (F12)
2. Go to **Network** tab
3. Submit the form
4. Look for a request to `supabase.co`
5. Check the **Response** tab for error details

---

## What to Report Back
Please share:
1. Any console errors you see
2. Whether the `messages` table exists in Supabase
3. Whether environment variables are set in Vercel
4. The exact error message from the form
